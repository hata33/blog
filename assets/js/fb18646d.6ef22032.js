"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[6480],{9233:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>i});const r=JSON.parse('{"id":"\u8ba1\u7b97\u673a\u7f51\u7edc/\u7f51\u7edc\u7f16\u7a0b","title":"\u7f51\u7edc\u7f16\u7a0b","description":"1. Socket \u7f16\u7a0b","source":"@site/docs/80-\u8ba1\u7b97\u673a\u7f51\u7edc/05-\u7f51\u7edc\u7f16\u7a0b.md","sourceDirName":"80-\u8ba1\u7b97\u673a\u7f51\u7edc","slug":"/\u8ba1\u7b97\u673a\u7f51\u7edc/\u7f51\u7edc\u7f16\u7a0b","permalink":"/blog/docs/\u8ba1\u7b97\u673a\u7f51\u7edc/\u7f51\u7edc\u7f16\u7a0b","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"\u7f51\u7edc\u5b89\u5168","permalink":"/blog/docs/\u8ba1\u7b97\u673a\u7f51\u7edc/\u7f51\u7edc\u5b89\u5168"},"next":{"title":"\u4ece\u8f93\u5165 URL \u5230\u9875\u9762\u6e32\u67d3\u7684\u5168\u8fc7\u7a0b","permalink":"/blog/docs/\u8ba1\u7b97\u673a\u7f51\u7edc/\u4ece\u8f93\u5165URL\u5230\u9875\u9762\u6e32\u67d3"}}');var o=s(4848),t=s(8453);const c={},l="\u7f51\u7edc\u7f16\u7a0b",a={},i=[{value:"1. Socket \u7f16\u7a0b",id:"1-socket-\u7f16\u7a0b",level:2},{value:"1.1 TCP Socket",id:"11-tcp-socket",level:3},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef",level:4},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef",level:4},{value:"1.2 UDP Socket",id:"12-udp-socket",level:3},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef-1",level:4},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef-1",level:4},{value:"2. WebSocket",id:"2-websocket",level:2},{value:"2.1 \u670d\u52a1\u7aef\u5b9e\u73b0",id:"21-\u670d\u52a1\u7aef\u5b9e\u73b0",level:3},{value:"2.2 \u5ba2\u6237\u7aef\u5b9e\u73b0",id:"22-\u5ba2\u6237\u7aef\u5b9e\u73b0",level:3},{value:"2.3 \u5b9e\u65f6\u804a\u5929\u793a\u4f8b",id:"23-\u5b9e\u65f6\u804a\u5929\u793a\u4f8b",level:3},{value:"3. HTTP/HTTPS \u670d\u52a1\u5668",id:"3-httphttps-\u670d\u52a1\u5668",level:2},{value:"3.1 HTTP \u670d\u52a1\u5668",id:"31-http-\u670d\u52a1\u5668",level:3},{value:"3.2 HTTPS \u670d\u52a1\u5668",id:"32-https-\u670d\u52a1\u5668",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",pre:"pre",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"\u7f51\u7edc\u7f16\u7a0b",children:"\u7f51\u7edc\u7f16\u7a0b"})}),"\n",(0,o.jsx)(n.h2,{id:"1-socket-\u7f16\u7a0b",children:"1. Socket \u7f16\u7a0b"}),"\n",(0,o.jsx)(n.h3,{id:"11-tcp-socket",children:"1.1 TCP Socket"}),"\n",(0,o.jsx)(n.h4,{id:"\u670d\u52a1\u7aef",children:"\u670d\u52a1\u7aef"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const net = require('net');\n\nconst server = net.createServer((socket) => {\n  console.log('Client connected');\n  \n  // \u8bbe\u7f6e\u7f16\u7801\n  socket.setEncoding('utf8');\n  \n  // \u63a5\u6536\u6570\u636e\n  socket.on('data', (data) => {\n    console.log('Received:', data);\n    // \u53d1\u9001\u54cd\u5e94\n    socket.write('Server received: ' + data);\n  });\n  \n  // \u9519\u8bef\u5904\u7406\n  socket.on('error', (err) => {\n    console.error('Socket error:', err);\n  });\n  \n  // \u8fde\u63a5\u5173\u95ed\n  socket.on('close', () => {\n    console.log('Client disconnected');\n  });\n});\n\n// \u9519\u8bef\u5904\u7406\nserver.on('error', (err) => {\n  if (err.code === 'EADDRINUSE') {\n    console.error('Port is already in use');\n  }\n});\n\nserver.listen(3000, () => {\n  console.log('Server listening on port 3000');\n});\n"})}),"\n",(0,o.jsx)(n.h4,{id:"\u5ba2\u6237\u7aef",children:"\u5ba2\u6237\u7aef"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const net = require('net');\n\nconst client = new net.Socket();\n\n// \u8fde\u63a5\u670d\u52a1\u5668\nclient.connect(3000, 'localhost', () => {\n  console.log('Connected to server');\n  \n  // \u53d1\u9001\u6570\u636e\n  client.write('Hello Server!');\n});\n\n// \u63a5\u6536\u6570\u636e\nclient.on('data', (data) => {\n  console.log('Received:', data);\n});\n\n// \u9519\u8bef\u5904\u7406\nclient.on('error', (err) => {\n  console.error('Connection error:', err);\n});\n\n// \u8fde\u63a5\u5173\u95ed\nclient.on('close', () => {\n  console.log('Connection closed');\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"12-udp-socket",children:"1.2 UDP Socket"}),"\n",(0,o.jsx)(n.h4,{id:"\u670d\u52a1\u7aef-1",children:"\u670d\u52a1\u7aef"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const dgram = require('dgram');\nconst server = dgram.createSocket('udp4');\n\nserver.on('message', (msg, rinfo) => {\n  console.log(`Received ${msg} from ${rinfo.address}:${rinfo.port}`);\n  \n  // \u53d1\u9001\u54cd\u5e94\n  server.send(`Server received: ${msg}`, rinfo.port, rinfo.address);\n});\n\nserver.on('listening', () => {\n  const address = server.address();\n  console.log(`Server listening on ${address.address}:${address.port}`);\n});\n\nserver.bind(3000);\n"})}),"\n",(0,o.jsx)(n.h4,{id:"\u5ba2\u6237\u7aef-1",children:"\u5ba2\u6237\u7aef"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const dgram = require('dgram');\nconst client = dgram.createSocket('udp4');\n\nconst message = Buffer.from('Hello Server!');\nclient.send(message, 3000, 'localhost', (err) => {\n  if (err) {\n    console.error('Failed to send message');\n  } else {\n    console.log('Message sent');\n  }\n});\n\nclient.on('message', (msg, rinfo) => {\n  console.log(`Received: ${msg} from ${rinfo.address}:${rinfo.port}`);\n  client.close();\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"2-websocket",children:"2. WebSocket"}),"\n",(0,o.jsx)(n.h3,{id:"21-\u670d\u52a1\u7aef\u5b9e\u73b0",children:"2.1 \u670d\u52a1\u7aef\u5b9e\u73b0"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const WebSocket = require('ws');\n\nconst wss = new WebSocket.Server({ port: 8080 });\n\nwss.on('connection', (ws) => {\n  console.log('New client connected');\n  \n  // \u53d1\u9001\u6b22\u8fce\u6d88\u606f\n  ws.send('Welcome to the WebSocket server!');\n  \n  // \u63a5\u6536\u6d88\u606f\n  ws.on('message', (message) => {\n    console.log('Received:', message);\n    \n    // \u5e7f\u64ad\u6d88\u606f\u7ed9\u6240\u6709\u5ba2\u6237\u7aef\n    wss.clients.forEach((client) => {\n      if (client !== ws && client.readyState === WebSocket.OPEN) {\n        client.send(message);\n      }\n    });\n  });\n  \n  // \u9519\u8bef\u5904\u7406\n  ws.on('error', (error) => {\n    console.error('WebSocket error:', error);\n  });\n  \n  // \u8fde\u63a5\u5173\u95ed\n  ws.on('close', () => {\n    console.log('Client disconnected');\n  });\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"22-\u5ba2\u6237\u7aef\u5b9e\u73b0",children:"2.2 \u5ba2\u6237\u7aef\u5b9e\u73b0"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"// \u5efa\u7acb\u8fde\u63a5\nconst ws = new WebSocket('ws://localhost:8080');\n\nws.onopen = () => {\n  console.log('Connected to server');\n  \n  // \u53d1\u9001\u6d88\u606f\n  ws.send('Hello from client!');\n};\n\nws.onmessage = (event) => {\n  console.log('Received:', event.data);\n};\n\nws.onerror = (error) => {\n  console.error('WebSocket error:', error);\n};\n\nws.onclose = () => {\n  console.log('Disconnected from server');\n};\n\n// \u5fc3\u8df3\u68c0\u6d4b\nfunction heartbeat() {\n  if (!ws) return;\n  if (ws.readyState !== 1) return;\n  \n  ws.send('ping');\n  setTimeout(heartbeat, 30000);\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"23-\u5b9e\u65f6\u804a\u5929\u793a\u4f8b",children:"2.3 \u5b9e\u65f6\u804a\u5929\u793a\u4f8b"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"// \u670d\u52a1\u7aef\nconst WebSocket = require('ws');\nconst wss = new WebSocket.Server({ port: 8080 });\n\nconst clients = new Map();\n\nwss.on('connection', (ws) => {\n  const id = generateId();\n  const color = generateColor();\n  const metadata = { id, color };\n  \n  clients.set(ws, metadata);\n  \n  ws.on('message', (messageAsString) => {\n    const message = JSON.parse(messageAsString);\n    const metadata = clients.get(ws);\n    \n    message.sender = metadata.id;\n    message.color = metadata.color;\n    \n    [...clients.keys()].forEach((client) => {\n      client.send(JSON.stringify(message));\n    });\n  });\n  \n  ws.on('close', () => {\n    clients.delete(ws);\n  });\n});\n\n// \u5ba2\u6237\u7aef\nconst ws = new WebSocket('ws://localhost:8080');\n\nws.onmessage = (event) => {\n  const message = JSON.parse(event.data);\n  \n  addMessageToChat(message);\n};\n\nfunction sendMessage(text) {\n  const message = {\n    text,\n    timestamp: Date.now()\n  };\n  \n  ws.send(JSON.stringify(message));\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"3-httphttps-\u670d\u52a1\u5668",children:"3. HTTP/HTTPS \u670d\u52a1\u5668"}),"\n",(0,o.jsx)(n.h3,{id:"31-http-\u670d\u52a1\u5668",children:"3.1 HTTP \u670d\u52a1\u5668"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const http = require('http');\n\nconst server = http.createServer((req, res) => {\n  // CORS \u8bbe\u7f6e\n  res.setHeader('Access-Control-Allow-Origin', '*');\n  \n  // \u8def\u7531\u5904\u7406\n  if (req.url === '/api/data' && req.method === 'GET') {\n    handleGetData(req, res);\n  } else if (req.url === '/api/user' && req.method === 'POST') {\n    handleCreateUser(req, res);\n  } else {\n    res.writeHead(404);\n    res.end('Not Found');\n  }\n});\n\nserver.listen(3000, () => {\n  console.log('Server running at http://localhost:3000/');\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"32-https-\u670d\u52a1\u5668",children:"3.2 HTTPS \u670d\u52a1\u5668"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const https = require('https');\nconst fs = require('fs');\n\nconst options = {\n  key: fs.readFileSync('private-key.pem'),\n  cert: fs.readFileSync('certificate.pem')\n};\n\nconst server = https.createServer(options, (req, res) => {\n  res.writeHead(200);\n  res.end('Hello Secure World\\n');\n});\n\nserver.listen(443, () => {\n  console.log('Server running at https://localhost/');\n});\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>l});var r=s(6540);const o={},t=r.createContext(o);function c(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);