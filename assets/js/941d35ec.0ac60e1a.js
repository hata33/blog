"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[3787],{2846:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"\u8ba1\u7b97\u673a\u7f51\u7edc/\u7f51\u7edc\u5b89\u5168","title":"\u7f51\u7edc\u5b89\u5168","description":"1. Web \u5b89\u5168\u653b\u51fb\u4e0e\u9632\u5fa1","source":"@site/docs/80-\u8ba1\u7b97\u673a\u7f51\u7edc/04-\u7f51\u7edc\u5b89\u5168.md","sourceDirName":"80-\u8ba1\u7b97\u673a\u7f51\u7edc","slug":"/\u8ba1\u7b97\u673a\u7f51\u7edc/\u7f51\u7edc\u5b89\u5168","permalink":"/blog/docs/\u8ba1\u7b97\u673a\u7f51\u7edc/\u7f51\u7edc\u5b89\u5168","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"HTTP \u534f\u8bae\u8be6\u89e3","permalink":"/blog/docs/\u8ba1\u7b97\u673a\u7f51\u7edc/HTTP\u534f\u8bae"},"next":{"title":"\u7f51\u7edc\u7f16\u7a0b","permalink":"/blog/docs/\u8ba1\u7b97\u673a\u7f51\u7edc/\u7f51\u7edc\u7f16\u7a0b"}}');var s=r(4848),i=r(8453);const c={},a="\u7f51\u7edc\u5b89\u5168",d={},o=[{value:"1. Web \u5b89\u5168\u653b\u51fb\u4e0e\u9632\u5fa1",id:"1-web-\u5b89\u5168\u653b\u51fb\u4e0e\u9632\u5fa1",level:2},{value:"1.1 XSS (\u8de8\u7ad9\u811a\u672c\u653b\u51fb)",id:"11-xss-\u8de8\u7ad9\u811a\u672c\u653b\u51fb",level:3},{value:"\u53cd\u5c04\u578b XSS",id:"\u53cd\u5c04\u578b-xss",level:4},{value:"\u5b58\u50a8\u578b XSS",id:"\u5b58\u50a8\u578b-xss",level:4},{value:"DOM\u578b XSS",id:"dom\u578b-xss",level:4},{value:"1.2 CSRF (\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020)",id:"12-csrf-\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020",level:3},{value:"\u653b\u51fb\u539f\u7406",id:"\u653b\u51fb\u539f\u7406",level:4},{value:"\u9632\u5fa1\u65b9\u6cd5",id:"\u9632\u5fa1\u65b9\u6cd5",level:4},{value:"1.3 SQL \u6ce8\u5165",id:"13-sql-\u6ce8\u5165",level:3},{value:"\u653b\u51fb\u793a\u4f8b",id:"\u653b\u51fb\u793a\u4f8b",level:4},{value:"\u9632\u5fa1\u65b9\u6cd5",id:"\u9632\u5fa1\u65b9\u6cd5-1",level:4},{value:"2. \u52a0\u5bc6\u6280\u672f",id:"2-\u52a0\u5bc6\u6280\u672f",level:2},{value:"2.1 \u5bf9\u79f0\u52a0\u5bc6",id:"21-\u5bf9\u79f0\u52a0\u5bc6",level:3},{value:"2.2 \u975e\u5bf9\u79f0\u52a0\u5bc6",id:"22-\u975e\u5bf9\u79f0\u52a0\u5bc6",level:3},{value:"2.3 \u54c8\u5e0c\u7b97\u6cd5",id:"23-\u54c8\u5e0c\u7b97\u6cd5",level:3},{value:"3. \u7f51\u7edc\u653b\u51fb\u9632\u5fa1",id:"3-\u7f51\u7edc\u653b\u51fb\u9632\u5fa1",level:2},{value:"3.1 DDoS \u9632\u5fa1",id:"31-ddos-\u9632\u5fa1",level:3},{value:"3.2 WAF \u914d\u7f6e",id:"32-waf-\u914d\u7f6e",level:3}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u7f51\u7edc\u5b89\u5168",children:"\u7f51\u7edc\u5b89\u5168"})}),"\n",(0,s.jsx)(n.h2,{id:"1-web-\u5b89\u5168\u653b\u51fb\u4e0e\u9632\u5fa1",children:"1. Web \u5b89\u5168\u653b\u51fb\u4e0e\u9632\u5fa1"}),"\n",(0,s.jsx)(n.h3,{id:"11-xss-\u8de8\u7ad9\u811a\u672c\u653b\u51fb",children:"1.1 XSS (\u8de8\u7ad9\u811a\u672c\u653b\u51fb)"}),"\n",(0,s.jsx)(n.h4,{id:"\u53cd\u5c04\u578b-xss",children:"\u53cd\u5c04\u578b XSS"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u653b\u51fb\u793a\u4f8b\nhttp://example.com/search?q=<script>alert('XSS')<\/script>\n\n// \u9632\u5fa1\u65b9\u6cd5\nfunction escapeHtml(str) {\n  return str.replace(/[&<>\"']/g, function(match) {\n    const escape = {\n      '&': '&amp;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '\"': '&quot;',\n      \"'\": '&#39;'\n    };\n    return escape[match];\n  });\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u5b58\u50a8\u578b-xss",children:"\u5b58\u50a8\u578b XSS"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u653b\u51fb\u793a\u4f8b\nconst comment = '<img src=\"x\" onerror=\"alert(document.cookie)\">';\n\n// \u9632\u5fa1\u65b9\u6cd5\n// 1. \u8f93\u5165\u8fc7\u6ee4\nconst sanitize = require('xss');\nconst safeComment = sanitize(comment);\n\n// 2. CSP \u7b56\u7565\nContent-Security-Policy: default-src 'self'\n"})}),"\n",(0,s.jsx)(n.h4,{id:"dom\u578b-xss",children:"DOM\u578b XSS"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u653b\u51fb\u793a\u4f8b\nlocation.hash = '<script>alert(1)<\/script>';\ndocument.write(location.hash.substring(1));\n\n// \u9632\u5fa1\u65b9\u6cd5\n// 1. \u907f\u514d\u4f7f\u7528 innerHTML\u3001document.write\nelement.textContent = userInput;\n\n// 2. \u4f7f\u7528 DOMPurify\nimport DOMPurify from 'dompurify';\nconst clean = DOMPurify.sanitize(dirty);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"12-csrf-\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020",children:"1.2 CSRF (\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020)"}),"\n",(0,s.jsx)(n.h4,{id:"\u653b\u51fb\u539f\u7406",children:"\u653b\u51fb\u539f\u7406"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'\x3c!-- \u653b\u51fb\u793a\u4f8b --\x3e\n<form action="http://bank.com/transfer" method="POST">\n  <input type="hidden" name="account" value="hacker"/>\n  <input type="hidden" name="amount" value="10000"/>\n</form>\n<script>document.forms[0].submit();<\/script>\n'})}),"\n",(0,s.jsx)(n.h4,{id:"\u9632\u5fa1\u65b9\u6cd5",children:"\u9632\u5fa1\u65b9\u6cd5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// 1. Token \u9a8c\u8bc1\nconst csrfToken = generateToken();\n// \u5728\u8868\u5355\u4e2d\u6dfb\u52a0 token\n<input type="hidden" name="_csrf" value="${csrfToken}">\n\n// 2. \u9a8c\u8bc1 Referer\napp.use((req, res, next) => {\n  const referer = req.headers.referer;\n  if (isValidReferer(referer)) {\n    next();\n  } else {\n    res.status(403).send(\'Invalid referer\');\n  }\n});\n\n// 3. SameSite Cookie\nSet-Cookie: session=123; SameSite=Strict\n'})}),"\n",(0,s.jsx)(n.h3,{id:"13-sql-\u6ce8\u5165",children:"1.3 SQL \u6ce8\u5165"}),"\n",(0,s.jsx)(n.h4,{id:"\u653b\u51fb\u793a\u4f8b",children:"\u653b\u51fb\u793a\u4f8b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- 1. \u57fa\u672c\u6ce8\u5165\nSELECT * FROM users WHERE username = 'admin' OR '1'='1'\n\n-- 2. \u8054\u5408\u67e5\u8be2\u6ce8\u5165\nSELECT * FROM users WHERE id = '1' UNION SELECT username,password FROM admin--'\n\n-- 3. \u65f6\u95f4\u76f2\u6ce8\nSELECT * FROM users WHERE id = '1' AND IF(SUBSTR(database(),1,1)='a',SLEEP(5),0)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u9632\u5fa1\u65b9\u6cd5-1",children:"\u9632\u5fa1\u65b9\u6cd5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// 1. \u53c2\u6570\u5316\u67e5\u8be2\nconst sql = 'SELECT * FROM users WHERE id = ?';\nconnection.query(sql, [userId]);\n\n// 2. ORM\nconst user = await User.findOne({\n  where: { id: userId }\n});\n\n// 3. \u8f93\u5165\u9a8c\u8bc1\nfunction validateUserId(id) {\n  return /^\\d+$/.test(id);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"2-\u52a0\u5bc6\u6280\u672f",children:"2. \u52a0\u5bc6\u6280\u672f"}),"\n",(0,s.jsx)(n.h3,{id:"21-\u5bf9\u79f0\u52a0\u5bc6",children:"2.1 \u5bf9\u79f0\u52a0\u5bc6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// AES \u52a0\u5bc6\u793a\u4f8b\nconst crypto = require('crypto');\n\nfunction encrypt(text, key) {\n  const iv = crypto.randomBytes(16);\n  const cipher = crypto.createCipheriv('aes-256-gcm', key, iv);\n  \n  let encrypted = cipher.update(text, 'utf8', 'hex');\n  encrypted += cipher.final('hex');\n  \n  const authTag = cipher.getAuthTag();\n  \n  return {\n    iv: iv.toString('hex'),\n    encrypted,\n    authTag: authTag.toString('hex')\n  };\n}\n\nfunction decrypt(encrypted, key, iv, authTag) {\n  const decipher = crypto.createDecipheriv('aes-256-gcm', key, Buffer.from(iv, 'hex'));\n  decipher.setAuthTag(Buffer.from(authTag, 'hex'));\n  \n  let decrypted = decipher.update(encrypted, 'hex', 'utf8');\n  decrypted += decipher.final('utf8');\n  \n  return decrypted;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"22-\u975e\u5bf9\u79f0\u52a0\u5bc6",children:"2.2 \u975e\u5bf9\u79f0\u52a0\u5bc6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// RSA \u52a0\u5bc6\u793a\u4f8b\nconst crypto = require('crypto');\n\n// \u751f\u6210\u5bc6\u94a5\u5bf9\nconst { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {\n  modulusLength: 2048,\n  publicKeyEncoding: {\n    type: 'spki',\n    format: 'pem'\n  },\n  privateKeyEncoding: {\n    type: 'pkcs8',\n    format: 'pem'\n  }\n});\n\n// \u52a0\u5bc6\nfunction encrypt(text, publicKey) {\n  const encrypted = crypto.publicEncrypt(\n    publicKey,\n    Buffer.from(text)\n  );\n  return encrypted.toString('base64');\n}\n\n// \u89e3\u5bc6\nfunction decrypt(encrypted, privateKey) {\n  const decrypted = crypto.privateDecrypt(\n    privateKey,\n    Buffer.from(encrypted, 'base64')\n  );\n  return decrypted.toString('utf8');\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"23-\u54c8\u5e0c\u7b97\u6cd5",children:"2.3 \u54c8\u5e0c\u7b97\u6cd5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u5bc6\u7801\u54c8\u5e0c\u793a\u4f8b\nconst crypto = require('crypto');\n\n// \u4f7f\u7528 PBKDF2\nasync function hashPassword(password) {\n  const salt = crypto.randomBytes(16);\n  const iterations = 100000;\n  const keylen = 64;\n  \n  return new Promise((resolve, reject) => {\n    crypto.pbkdf2(password, salt, iterations, keylen, 'sha512', (err, derivedKey) => {\n      if (err) reject(err);\n      resolve({\n        hash: derivedKey.toString('hex'),\n        salt: salt.toString('hex'),\n        iterations\n      });\n    });\n  });\n}\n\n// \u9a8c\u8bc1\u5bc6\u7801\nasync function verifyPassword(password, hash, salt, iterations) {\n  return new Promise((resolve, reject) => {\n    crypto.pbkdf2(password, Buffer.from(salt, 'hex'), iterations, 64, 'sha512', (err, derivedKey) => {\n      if (err) reject(err);\n      resolve(derivedKey.toString('hex') === hash);\n    });\n  });\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"3-\u7f51\u7edc\u653b\u51fb\u9632\u5fa1",children:"3. \u7f51\u7edc\u653b\u51fb\u9632\u5fa1"}),"\n",(0,s.jsx)(n.h3,{id:"31-ddos-\u9632\u5fa1",children:"3.1 DDoS \u9632\u5fa1"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u901f\u7387\u9650\u5236\u4e2d\u95f4\u4ef6\nconst rateLimit = require('express-rate-limit');\n\nconst limiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15\u5206\u949f\n  max: 100 // \u9650\u5236\u6bcf\u4e2aIP 100\u4e2a\u8bf7\u6c42\n});\n\napp.use(limiter);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"32-waf-\u914d\u7f6e",children:"3.2 WAF \u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-nginx",children:'# Nginx WAF \u914d\u7f6e\u793a\u4f8b\nhttp {\n  # \u9650\u5236\u8bf7\u6c42\u5927\u5c0f\n  client_max_body_size 10m;\n  \n  # \u9650\u5236\u8fde\u63a5\u6570\n  limit_conn_zone $binary_remote_addr zone=addr:10m;\n  limit_conn addr 100;\n  \n  # \u9632\u6b62 SQL \u6ce8\u5165\n  if ($request_uri ~* ".*[;\'<>].*") {\n    return 403;\n  }\n  \n  # \u7981\u6b62\u7279\u5b9a User-Agent\n  if ($http_user_agent ~* (Wget|Curl)) {\n    return 403;\n  }\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>a});var t=r(6540);const s={},i=t.createContext(s);function c(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);